#
# This is the main Apache HTTP server configuration file.  It contains the
# configuration directives that give the server its instructions.
# See <URL:http://httpd.apache.org/docs/2.4/> for detailed information.
# In particular, see 
# <URL:http://httpd.apache.org/docs/2.4/mod/directives.html>
# for a discussion of each configuration directive.
#

#
# ServerRoot: The top of the directory tree under which the server's
# configuration, error, and log files are kept.
#
ServerRoot "/etc/httpd"

#
# Listen: Allows you to bind Apache to specific IP addresses and/or
# ports, instead of the default. See also the <VirtualHost>
# directive.
#
Listen 8080
Listen 8443

#
# Dynamic Shared Object (DSO) Support
#
LoadModule alias_module modules/mod_alias.so
LoadModule auth_openidc_module modules/mod_auth_openidc.so
LoadModule authn_core_module modules/mod_authn_core.so
LoadModule authz_core_module modules/mod_authz_core.so
LoadModule authz_user_module modules/mod_authz_user.so
LoadModule dir_module modules/mod_dir.so
LoadModule env_module modules/mod_env.so
LoadModule filter_module modules/mod_filter.so
LoadModule headers_module modules/mod_headers.so
LoadModule include_module modules/mod_include.so
LoadModule log_config_module modules/mod_log_config.so
LoadModule log_debug_module modules/mod_log_debug.so
LoadModule logio_module modules/mod_logio.so
LoadModule mime_module modules/mod_mime.so
LoadModule proxy_module modules/mod_proxy.so
LoadModule proxy_http_module modules/mod_proxy_http.so
LoadModule remoteip_module modules/mod_remoteip.so
LoadModule rewrite_module modules/mod_rewrite.so
LoadModule setenvif_module modules/mod_setenvif.so
LoadModule socache_shmcb_module modules/mod_socache_shmcb.so
LoadModule ssl_module modules/mod_ssl.so
LoadModule unique_id_module modules/mod_unique_id.so
LoadModule unixd_module modules/mod_unixd.so

# event MPM: A variant of the worker MPM with the goal of consuming
# threads only for connections with active processing
# See: http://httpd.apache.org/docs/2.4/mod/event.html
#
LoadModule mpm_event_module modules/mod_mpm_event.so
#Include conf.modules.d/*.conf


#
# ServerName gives the name and port that the server uses to identify itself.
# This can often be determined automatically, but we recommend you specify
# it explicitly to prevent problems during startup.
#
ServerName "localhost"

User apache
Group apache

#
# Deny access to the entirety of your server's filesystem. You must
# explicitly permit access to web content directories in other 
# <Directory> blocks below.
#
<Directory />
    AllowOverride none
    Require all denied
</Directory>


#
# DocumentRoot: The directory out of which you will serve your
# documents. By default, all requests are taken from this directory, but
# symbolic links and aliases may be used to point to other locations.
#
DocumentRoot "/var/www/html"

<Directory "/var/www/html">
    Options FollowSymLinks Indexes IncludesNoExec
    AddOutputFilter Includes .json
    DirectoryIndex index.json
    AllowOverride None
    Require all granted
</Directory>

# Maps HTTP error codes to JSON-based messages
<Directory "/usr/share/httpd/error">
    Options IncludesNoExec
    AddOutputFilter Includes .json
    Require all granted
</Directory>

Alias /error/ "/usr/share/httpd/error/"

ErrorDocument 400 /error/400-bad-request.json
ErrorDocument 401 /error/401-unauthorized.json
ErrorDocument 403 /error/403-forbidden.json
ErrorDocument 404 /error/404-not-found.json
ErrorDocument 405 /error/405-method-not-allowed.json
ErrorDocument 408 /error/408-request-timeout.json
ErrorDocument 414 /error/415-request-uri-too-large.json
ErrorDocument 500 /error/500-internal-server-error.json
ErrorDocument 502 /error/502-bad-gateway.json
ErrorDocument 503 /error/503-service-unavailable.json

#
# Error Log 
#
ErrorLog "/proc/self/fd/1"
#ErrorLogFormat
LogLevel ${LOG_LEVEL} ssl:warn


#
# Access Log
#
LogFormat "%h %l %u %t \"%r\" %>s %b \"%{Referer}i\" \"%{User-Agent}i\" %I %O"
TransferLog "/proc/self/fd/1" 


#
# TypesConfig points to the file containing the list of mappings from
# filename extension to MIME-type.
#
TypesConfig /etc/mime.types


#
# Specify a default charset for all content served
#
AddDefaultCharset UTF-8


#
# EnableMMAP and EnableSendfile: On systems that support it, 
# memory-mapping or the sendfile syscall may be used to deliver
# files.  This usually improves server performance, but must
# be turned off when serving from networked-mounted 
# filesystems or if support for these functions is otherwise
# broken on your system.
# Defaults if commented: EnableMMAP On, EnableSendfile Off
#
#EnableMMAP off
EnableSendfile on

# Supplemental configuration
#
# Load config files in the "/etc/httpd/conf.d" directory, if any.
IncludeOptional conf.d/*.conf


# ServerTokens
# This directive configures what you return as the Server HTTP response
# Header. The default is 'Full' which sends information about the OS-Type
# and compiled in modules.
ServerTokens Minor

# Disable TRACE method
TraceEnable Off

# Setting this header will prevent MSIE from interpreting files as something
# else than declared by the content type in the HTTP headers.
Header set X-Content-Type-Options: "nosniff"

# Setting this header will prevent other sites from embedding pages from this
# site as frames. This defends against clickjacking attacks.
Header set X-Frame-Options: "sameorigin"

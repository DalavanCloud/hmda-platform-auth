#NameVirtualHost *:80

#<VirtualHost *:80>
  #ServerName 192.168.99.100 
#  Redirect permanent / https://192.168.99.100:8443/
#</VirtualHost>

#<VirtualHost *:443>
<VirtualHost *:80>
  #ServerName 192.168.99.100 
  ServerAdmin webmaster@localhost
  DocumentRoot /var/www/html
 
  SSLEngine On
  SSLCertificateFile    /etc/ssl/certs/ssl-cert-snakeoil.pem
  SSLCertificateKeyFile /etc/ssl/private/ssl-cert-snakeoil.key
 
  # Available loglevels: trace8, ..., trace1, debug, info, notice, warn,
  # error, crit, alert, emerg.
  # It is also possible to configure the loglevel for particular
  # modules, e.g.
  #LogLevel info ssl:warn

  # FIXME: See how official image handles this.  Globally? 
  ErrorLog /dev/stderr 
  CustomLog /dev/stdout combined
 
  OIDCCryptoPassphrase 1234567890
  OIDCProviderMetadataURL http://192.168.99.100:9080/auth/realms/master/.well-known/openid-configuration 
  OIDCClientID admin-api
  OIDCRedirectURI https://192.168.99.100:8443/redirect_url
  OIDCRemoteUserClaim preferred_username
  OIDCResponseType "id_token token"
 
  <Location /secure/>
    AuthType openid-connect
    Require valid-user
  </Location>

  OIDCOAuthClientID admin-api
  OIDCOAuthSSLValidateServer Off
  OIDCOAuthRemoteUserClaim preferred_username
  OIDCOAuthIntrospectionEndpoint https://192.168.99.100:9080/auth/realms/master/protocol/openid-connect/token/introspect
  #OIDCOAuthVerifyJwksUri https://192.168.99.100:9443/auth/realms/master/protocol/openid-connect/certs

  <Location /api/*>
    AuthType oauth20
    Require valid-user
    ProxyPass http://echo:5000
    ProxyPassReverse http://echo:5000 
  </Location>

</VirtualHost>

